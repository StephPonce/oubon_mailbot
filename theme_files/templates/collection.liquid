<div class="section">
  <div class="container">
    {%- comment -%} Collection Header {%- endcomment -%}
    <div class="section-header">
      <h1 class="section-title">{{ collection.title }}</h1>
      {%- if collection.description != blank -%}
        <p class="section-subtitle">{{ collection.description }}</p>
      {%- endif -%}
    </div>

    {%- comment -%} Product Count {%- endcomment -%}
    <div style="text-align: center; margin-bottom: 2rem; color: var(--color-gray-600);">
      {{ collection.products_count }} {% if collection.products_count == 1 %}product{% else %}products{% endif %}
    </div>

    {%- comment -%} Products Grid {%- endcomment -%}
    {%- if collection.products.size > 0 -%}
      <div class="grid grid-3">
        {%- for product in collection.products -%}
          <div class="product-card">
            <a href="{{ product.url }}" class="product-image">
              {%- if product.featured_image -%}
                <img
                  src="{{ product.featured_image | img_url: '600x' }}"
                  alt="{{ product.featured_image.alt | escape }}"
                  loading="lazy"
                  width="600"
                  height="450"
                >
              {%- else -%}
                <div style="width: 100%; height: 100%; background: var(--color-gray-100);"></div>
              {%- endif -%}

              {%- assign score = product.metafields.custom.priority_score | default: 7 -%}
              {%- if score >= 7.5 -%}
                <span class="product-badge high">HIGH üî•</span>
              {%- elsif score >= 5.5 -%}
                <span class="product-badge">MEDIUM</span>
              {%- endif -%}
            </a>

            <div class="product-content">
              {%- if product.type != blank -%}
                <div class="product-category">{{ product.type }}</div>
              {%- endif -%}

              <h3 class="product-name">
                <a href="{{ product.url }}">{{ product.title }}</a>
              </h3>

              <div class="product-price">
                <span class="price-current">{{ product.price | money }}</span>
                {%- if product.compare_at_price > product.price -%}
                  <span class="price-compare">{{ product.compare_at_price | money }}</span>
                {%- endif -%}
              </div>

              <a href="{{ product.url }}" class="btn btn-primary product-cta">
                View Product ‚Üí
              </a>
            </div>
          </div>
        {%- endfor -%}
      </div>

      {%- comment -%} Pagination {%- endcomment -%}
      {%- if paginate.pages > 1 -%}
        <div style="margin-top: 4rem; text-align: center;">
          {%- if paginate.previous -%}
            <a href="{{ paginate.previous.url }}" class="btn btn-outline">‚Üê Previous</a>
          {%- endif -%}

          <span style="margin: 0 1rem; color: var(--color-gray-600);">
            Page {{ paginate.current_page }} of {{ paginate.pages }}
          </span>

          {%- if paginate.next -%}
            <a href="{{ paginate.next.url }}" class="btn btn-outline">Next ‚Üí</a>
          {%- endif -%}
        </div>
      {%- endif -%}
    {%- else -%}
      <div class="empty-state" style="text-align: center; padding: 5rem 0;">
        <h3 style="font-size: var(--text-2xl); margin-bottom: 1rem;">No products found</h3>
        <p style="color: var(--color-gray-600); margin-bottom: 2rem;">This collection is currently empty.</p>
        <a href="/collections/all" class="btn btn-primary">Browse All Products</a>
      </div>
    {%- endif -%}
  </div>
</div>

{%- paginate collection.products by 12 -%}
{%- endpaginate -%}
